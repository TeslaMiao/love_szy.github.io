<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>æ¬¢è¿è¿›å…¥è‹—é›…æ°çš„å†…å¿ƒä¸–ç•Œ | ä¸ƒå¤•é™å®š</title>
  <style>
    :root{
      --bg1:#0f1021; --bg2:#1b1c3a; --acc1:#ff6b9f; --acc2:#ff8fab; --text:#f5f7ff; --muted:#aeb3d0;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 70% -10%, #1d1e3f 0%, transparent 60%),linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);font:16px/1.6 "SF Pro Display","PingFang SC","Hiragino Sans GB","Microsoft YaHei",system-ui,Segoe UI,Roboto,Helvetica,Arial;overflow:hidden}
    .container{position:relative;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;padding:clamp(16px,2vw,28px);text-align:center}
    h1{font-size:clamp(22px,5vw,48px);margin:0;letter-spacing:.5px;background:linear-gradient(90deg,#ffd1dc,#fff,#ffd1dc);-webkit-background-clip:text;color:transparent;text-shadow:0 0 20px rgba(255,105,180,.15)}
    .subtitle{font-size:clamp(14px,2.2vw,18px);color:var(--muted);margin-top:-8px}
    .heart-wrap{position:relative;width:180px;height:160px;cursor:pointer}
    .heart{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(1);width:140px;height:130px;filter:drop-shadow(0 10px 24px rgba(255,100,140,.25));animation:beat 1.2s ease-in-out infinite}
    @keyframes beat{0%,100%{transform:translate(-50%,-50%) scale(1)}25%{transform:translate(-50%,-50%) scale(1.08)}50%{transform:translate(-50%,-50%) scale(.98)}75%{transform:translate(-50%,-50%) scale(1.06)}}
    .heart:hover{animation-duration:.9s}
    .tip{font-size:12px;color:var(--muted);opacity:.8;margin-top:-6px}
    #click-canvas,#bg-canvas{position:fixed;inset:0;pointer-events:none}
    .footer{position:fixed;bottom:0;left:0;right:0;padding:12px clamp(16px,4vw,32px);background:linear-gradient(180deg,transparent,rgba(15,16,33,.55) 30%, rgba(15,16,33,.85))}
    .typewriter{font-size:clamp(14px,2.4vw,18px);white-space:pre-wrap;min-height:2.2em}
    .badge{position:absolute;top:16px;right:16px;padding:6px 10px;font-size:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:999px;backdrop-filter:blur(6px)}
    .controls{position:fixed;top:16px;left:16px;display:flex;gap:10px}
    button.icon{appearance:none;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:var(--text);padding:8px 10px;border-radius:999px;font-size:13px;cursor:pointer;backdrop-filter:blur(6px);transition:.2s transform,.2s background}
    button.icon:hover{transform:translateY(-1px);background:rgba(255,255,255,.12)}
    .counter{font-size:12px;margin-top:4px;color:var(--muted)}
    @media (max-width:480px){.heart-wrap{width:150px;height:130px}.heart{width:120px;height:110px}}
  </style>
</head>
<body>
  <canvas id="bg-canvas" aria-hidden="true"></canvas>
  <canvas id="click-canvas" aria-hidden="true"></canvas>

  <div class="controls">
    <button id="musicBtn" class="icon" aria-pressed="false">â™« è½»éŸ³ä¹</button>
    <button id="fireworksBtn" class="icon">âœ¨ çƒŸèŠ±æ¨¡å¼</button>
  </div>

  <div class="badge">ä¸ƒå¤•å¿«ä¹</div>

  <main class="container">
    <h1>æ¬¢è¿è¿›å…¥<span style="white-space:nowrap">è‹—é›…æ°</span>çš„å†…å¿ƒä¸–ç•Œ</h1>
    <div class="subtitle">æ­¤åˆ»ï¼Œå¿ƒè·³åªä¸ºä½ åŠ é€Ÿ</div>

    <div class="heart-wrap" id="heartWrap" title="ç‚¹æˆ‘ä¸€ä¸‹~">
      <!-- SVG å¿ƒå½¢ -->
      <svg class="heart" viewBox="0 0 512 470" role="img" aria-label="çˆ±å¿ƒ">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#ff6b9f"/>
            <stop offset="100%" stop-color="#ff8fab"/>
          </linearGradient>
        </defs>
        <path fill="url(#g)" d="M471.7,73.6c-52.7-58.2-138.4-58.2-191.1,0l-24.9,27.5l-24.9-27.5c-52.7-58.2-138.4-58.2-191.1,0
        c-57.7,63.8-48.5,156.6,20.6,215.5c54.4,46.5,114.5,88.4,179.9,122.3c5.6,2.9,12.2,2.9,17.8,0c65.5-33.9,125.5-75.8,179.9-122.3
        C520.2,230.2,529.4,137.4,471.7,73.6z"/>
      </svg>
    </div>
    <div class="tip">æç¤ºï¼šç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ä¼šå‡ºç°å¯çˆ±çš„çˆ±å¿ƒç²’å­ï½</div>
    <div class="counter" id="togetherDays"></div>
  </main>

  <footer class="footer">
    <div id="typewriter" class="typewriter"></div>
  </footer>

  <script>
    /* =========================
       1) èƒŒæ™¯ï¼šæŸ”å’Œæ˜Ÿç©º + æµæ˜Ÿ
       ========================= */
    const bg = document.getElementById('bg-canvas');
    const bctx = bg.getContext('2d', { alpha: true });
    function resize(){
      bg.width = innerWidth; bg.height = innerHeight;
      clickCanvas.width = innerWidth; clickCanvas.height = innerHeight;
    }
    addEventListener('resize', resize);

    /* éšæœºæ˜Ÿç©º */
    let stars=[];
    function spawnStars(){
      stars = Array.from({length: Math.min(200, Math.floor((innerWidth*innerHeight)/5000))}, ()=>({
        x: Math.random()*innerWidth,
        y: Math.random()*innerHeight,
        r: Math.random()*1.2+0.3,
        tw: Math.random()*0.8+0.2,
        phase: Math.random()*Math.PI*2
      }));
    }
    function drawStars(t){
      bctx.clearRect(0,0,bg.width,bg.height);
      for(const s of stars){
        s.phase += 0.02;
        const alpha = 0.5 + Math.sin(s.phase)*0.5*s.tw;
        bctx.globalAlpha = alpha;
        bctx.beginPath();
        bctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        bctx.fillStyle = '#ffffff';
        bctx.fill();
      }
      // å¶å°”æµæ˜Ÿ
      if (Math.random() < 0.005){
        const sx = Math.random()*innerWidth, sy = Math.random()*innerHeight*0.3;
        shootStar(sx, sy);
      }
    }

    /* æµæ˜Ÿ */
    let meteors=[];
    function shootStar(x,y){ meteors.push({x, y, vx: 6, vy: 3, life: 22}); }
    function drawMeteors(){
      for (let i=meteors.length-1;i>=0;i--){
        const m = meteors[i];
        bctx.globalAlpha = Math.max(0, m.life/22);
        bctx.beginPath();
        bctx.moveTo(m.x, m.y);
        bctx.lineTo(m.x - 60, m.y - 30);
        bctx.strokeStyle = 'rgba(255,255,255,.8)';
        bctx.lineWidth = 2;
        bctx.stroke();
        m.x += m.vx; m.y += m.vy; m.life--;
        if (m.life<=0) meteors.splice(i,1);
      }
    }

    /* =========================
       2) ç‚¹å‡»ç²’å­ï¼šçˆ±å¿ƒ/çƒŸèŠ±
       ========================= */
    const clickCanvas = document.getElementById('click-canvas');
    const cctx = clickCanvas.getContext('2d');
    let particles = [];
    let fireworksMode = false;

    function heartParticle(x,y,baseV=2){
      const angle = Math.random()*Math.PI*2;
      const speed = baseV + Math.random()*1.8;
      const life = 50 + Math.random()*30;
      const scale = 0.4 + Math.random()*0.8;
      return {x,y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 2, life, maxLife: life, scale, rot: Math.random()*Math.PI};
    }

    function drawHeartPath(ctx, size=8){
      ctx.beginPath();
      for(let t=0;t<Math.PI*2;t+=0.05){
        // å¿ƒå½¢å‚æ•°æ–¹ç¨‹
        const x = size*16*Math.pow(Math.sin(t),3);
        const y = -size*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
        if (t===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath();
    }

    function emit(x,y,count,baseV){
      for(let i=0;i<count;i++) particles.push(heartParticle(x,y,baseV));
    }

    function clickEffect(e){
      const x = e.clientX, y = e.clientY;
      emit(x,y, fireworksMode ? 80 : 20, fireworksMode ? 5 : 2);
    }
    addEventListener('pointerdown', clickEffect);
    document.getElementById('heartWrap').addEventListener('click', (e)=>{
      const rect = e.currentTarget.getBoundingClientRect();
      emit(rect.left+rect.width/2, rect.top+rect.height/2, 30, 3);
    });

    function renderParticles(){
      cctx.clearRect(0,0,clickCanvas.width,clickCanvas.height);
      for (let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.vx; p.y += p.vy;
        p.vy += fireworksMode ? 0.02 : 0.05; // é‡åŠ›
        p.life--;
        const alpha = Math.max(0, p.life/p.maxLife);
        cctx.save();
        cctx.translate(p.x, p.y);
        cctx.rotate(p.rot += 0.03);
        cctx.scale(p.scale*(1+0.2*(1-alpha)), p.scale*(1+0.2*(1-alpha)));
        cctx.globalAlpha = alpha*0.9;
        drawHeartPath(cctx, 0.5 + 0.5*p.scale*8);
        const grd = cctx.createLinearGradient(-10,-10,10,10);
        grd.addColorStop(0, '#ff6b9f');
        grd.addColorStop(1, '#ff8fab');
        cctx.fillStyle = grd;
        cctx.fill();
        cctx.restore();
        if (p.life<=0) particles.splice(i,1);
      }
    }

    /* =========================
       3) æ‰“å­—æœºï¼šè¡¨ç™½æ–‡æ¡ˆ
       ========================= */
    const content = "åœ¨è¿™æµªæ¼«çš„ä¸ƒå¤•ï¼Œæˆ‘æƒ³æŠŠå¿ƒè·³æ”¾åœ¨ä½ æ‰‹å¿ƒï¼šä»é‡è§ä½ çš„é‚£å¤©èµ·ï¼Œæ˜Ÿæ²³æœ‰è¿¹ã€çˆ±æ„æœ‰å‡­ã€‚æ„¿ä»¥åæ¯ä¸€ä¸ªä»Šå¤©ï¼Œæˆ‘éƒ½æ›´çˆ±ä½ ã€‚";
    const tw = document.getElementById('typewriter');
    let idx=0;
    function type(){
      if (idx<=content.length){ tw.textContent = content.slice(0, idx++); }
    }

    /* =========================
       4) çºªå¿µæ—¥ï¼šåœ¨å·¦ä¸‹æ˜¾ç¤ºåœ¨ä¸€èµ·çš„å¤©æ•°ï¼ˆå¯ä¿®æ”¹æ—¥æœŸï¼‰
       ========================= */
    const togetherStart = new Date('2025-02-06'); // â† å°†è¿™é‡Œæ”¹æˆä½ ä»¬åœ¨ä¸€èµ·çš„æ—¥æœŸ
    const daysDom = document.getElementById('togetherDays');
    function renderDays(){
      const now = new Date();
      const days = Math.floor((now - togetherStart)/(1000*60*60*24)) + 1;
      daysDom.textContent = `æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ·ç¬¬ ${days} å¤©å•¦ â¤`;
    }

    /* =========================
       5) éŸ³ä¹ï¼šæ— ç‰ˆæƒï¼ŒWebAudio ç”ŸæˆæŸ”å’Œæ—‹å¾‹
       ========================= */
    let audioCtx=null, melodyTimer=null, isPlaying=false;
    function startMusic(){
      if (!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const notes = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25]; // Cå¤§è°ƒ
      let step = 0;
      function playNote(){
        if (!isPlaying) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.value = notes[step % notes.length];
        step++;
        g.gain.value = 0;
        g.gain.linearRampToValueAtTime(0.06, audioCtx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.8);
        o.connect(g).connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + 0.9);
        melodyTimer = setTimeout(playNote, 600 + Math.random()*300);
      }
      playNote();
    }
    function stopMusic(){ isPlaying=false; clearTimeout(melodyTimer); }

    const musicBtn = document.getElementById('musicBtn');
    musicBtn.addEventListener('click', ()=>{
      isPlaying = !isPlaying;
      musicBtn.setAttribute('aria-pressed', String(isPlaying));
      musicBtn.textContent = isPlaying ? 'â¸ æš‚åœéŸ³ä¹' : 'â™« è½»éŸ³ä¹';
      if (isPlaying){ startMusic(); } else { stopMusic(); }
    });

    /* =========================
       6) çƒŸèŠ±æ¨¡å¼å¼€å…³
       ========================= */
    document.getElementById('fireworksBtn').addEventListener('click', ()=>{
      fireworksMode = !fireworksMode;
      const btn = document.getElementById('fireworksBtn');
      btn.textContent = fireworksMode ? 'ğŸ’¥ å…³é—­çƒŸèŠ±' : 'âœ¨ çƒŸèŠ±æ¨¡å¼';
    });

    /* =========================
       7) ä¸»å¾ªç¯
       ========================= */
    function loop(t){
      drawStars(t);
      drawMeteors();
      renderParticles();
      requestAnimationFrame(loop);
    }
    function init(){
      resize(); spawnStars();
      renderDays();
      setInterval(renderDays, 60*1000);
      setInterval(type, 40); // æ‰“å­—é€Ÿåº¦
      requestAnimationFrame(loop);
    }
    init();
  </script>
</body>
</html>
